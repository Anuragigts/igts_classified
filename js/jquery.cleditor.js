!function(e){function t(t){var n=this,r=t.target,o=e.data(r,L),a=oe[o],i=a.popupName,s=re[i];if(!n.disabled&&e(r).attr(I)!==I){var l={editor:n,button:r,buttonName:o,popup:s,popupName:i,command:a.command,useCSS:n.options.useCSS};if(a.buttonClick&&a.buttonClick(t,l)===!1)return!1;if("source"===o)S(n)?(delete n.range,n.$area.hide(),n.$frame.show(),r.title=a.title):(n.$frame.hide(),n.$area.show(),r.title="Show Rich Text");else if(!S(n)){if(i){var u=e(s);if("url"===i){if("link"===o&&""===k(n))return x(n,"A selection is required when inserting a link.",r),!1;u.children(":button").unbind(z).bind(z,function(){var t=u.find(":text"),r=e.trim(t.val());""!==r&&d(n,l.command,r,null,l.button),t.val("http://"),h(),c(n)})}else"pastetext"===i&&u.children(":button").unbind(z).bind(z,function(){var e=u.find("textarea"),t=e.val().replace(/\n/g,"<br />");""!==t&&d(n,l.command,t,null,l.button),e.val(""),h(),c(n)});if(r!==e.data(s,R))return T(n,s,r),!1;return}if("print"===o)n.$frame[0].contentWindow.print();else if(!d(n,l.command,l.value,l.useCSS,r))return!1}c(n)}}function n(t){var n=e(t.target).closest("div");n.css(N,n.data(L)?"#FFF":"#FFC")}function r(t){e(t.target).closest("div").css(N,"transparent")}function o(t){var n=this,r=t.data.popup,o=t.target;if(r!==re.msg&&!e(r).hasClass(X)){var a,i=e.data(r,R),s=e.data(i,L),l=oe[s],u=l.command,p=n.options.useCSS;"font"===s?a=o.style.fontFamily.replace(/"/g,""):"size"===s?("DIV"===o.tagName.toUpperCase()&&(o=o.children[0]),a=o.innerHTML):"style"===s?a="<"+o.tagName+">":"color"===s?a=f(o.style.backgroundColor):"highlight"===s&&(a=f(o.style.backgroundColor),K?u="backcolor":p=!0);var m={editor:n,button:i,buttonName:s,popup:r,popupName:l.popupName,command:u,value:a,useCSS:p};if(!l.popupClick||l.popupClick(t,m)!==!1){if(m.command&&!d(n,m.command,m.value,m.useCSS,i))return!1;h(),c(n)}}}function a(e){for(var t=1,n=0,r=0;r<e.length;++r)t=(t+e.charCodeAt(r))%65521,n=(n+t)%65521;return n<<16|t}function i(e){e.$area.val(""),$(e)}function s(t,o,a,i,s){if(re[t])return re[t];var l=e(E).hide().addClass(_).appendTo("body");if(i)l.html(i);else if("color"===t){var d=o.colors.split(" ");d.length<10&&l.width("auto"),e.each(d,function(t,n){e(E).appendTo(l).css(N,"#"+n)}),a=Q}else"font"===t?e.each(o.fonts.split(","),function(t,n){e(E).appendTo(l).css("fontFamily",n).html(n)}):"size"===t?e.each(o.sizes.split(","),function(t,n){e(E).appendTo(l).html('<font size="'+n+'">'+n+"</font>")}):"style"===t?e.each(o.styles,function(t,n){e(E).appendTo(l).html(n[1]+n[0]+n[1].replace("<","</"))}):"url"===t?(l.html('<label>Enter URL:<br /><input type="text" value="http://" style="width:200px" /></label><br /><input type="button" value="Submit" />'),a=X):"pastetext"===t&&(l.html('<label>Paste your content here:<br /><textarea rows="3" style="width:200px"></textarea></label><br /><input type="button" value="Submit" />'),a=X);return a||i||(a=G),l.addClass(a),K&&l.attr(D,"on").find("div,font,p,h1,h2,h3,h4,h5,h6").attr(D,"on"),(l.hasClass(G)||s===!0)&&l.children().hover(n,r),re[t]=l[0],l[0]}function l(e,t){t?(e.$area.attr(I,I),e.disabled=!0):(e.$area.removeAttr(I),delete e.disabled);try{K?e.doc.body.contentEditable=!t:e.doc.designMode=t?"off":"on"}catch(n){}v(e)}function d(e,t,n,r,o){y(e),K||((void 0===r||null===r)&&(r=e.options.useCSS),e.doc.execCommand("styleWithCSS",0,r.toString()));var a="inserthtml"===t.toLowerCase();if(K&&a)u(e).pasteHTML(n);else if(ee&&a){var i=p(e),s=i.getRangeAt(0);s.deleteContents(),s.insertNode(s.createContextualFragment(n)),i.removeAllRanges(),i.addRange(s)}else{var l,d=!0;try{d=e.doc.execCommand(t,0,n||null)}catch(c){l=c.message,d=!1}d||("cutcopypaste".indexOf(t)>-1?x(e,"For security reasons, your browser does not support the "+t+" command. Try using the keyboard shortcut or context menu instead.",o):x(e,l?l:"Error executing the "+t+" command.",o))}return v(e),F(e,!0),d}function c(e){setTimeout(function(){S(e)?e.$area.focus():e.$frame[0].contentWindow.focus(),v(e)},0)}function u(e){return K?p(e).createRange():p(e).getRangeAt(0)}function p(e){return K?e.doc.selection:e.$frame[0].contentWindow.getSelection()}function f(e){var t=/rgba?\((\d+), (\d+), (\d+)/.exec(e);if(t){for(e=(t[1]<<16|t[2]<<8|t[3]).toString(16);e.length<6;)e="0"+e;return"#"+e}var n=e.split("");return 4===e.length?"#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]:e}function h(){e.each(re,function(t,n){e(n).hide().unbind(z).removeData(R)})}function m(){var t=e("link[href*=cleditor]").attr("href");return t.replace(/^(.*\/)[^\/]+$/,"$1")+"images/"}function g(e){return"url("+m()+e+")"}function b(t){var n=t.$main,r=t.options;t.$frame&&t.$frame.remove();var o=t.$frame=e('<iframe frameborder="0" src="javascript:true;" />').hide().appendTo(n),a=o[0].contentWindow,i=t.doc=a.document,s=e(i);i.open(),i.write(r.docType+"<html>"+(""===r.docCSSFile?"":'<head><link rel="stylesheet" type="text/css" href="'+r.docCSSFile+'" /></head>')+'<body id="content" class="cut_paste" style="'+r.bodyStyle+'; word-wrap: break-word;"></body></html>'),i.close(),(K||ee)&&s.click(function(){c(t)}),$(t),K||ee?(s.bind("beforedeactivate beforeactivate selectionchange keypress keyup",function(e){if("beforedeactivate"===e.type)t.inactive=!0;else if("beforeactivate"===e.type)!t.inactive&&t.range&&t.range.length>1&&t.range.shift(),delete t.inactive;else if(!t.inactive)for(t.range||(t.range=[]),t.range.unshift(u(t));t.range.length>2;)t.range.pop()}),o.focus(function(){y(t),e(t).triggerHandler(j)}),o.blur(function(){e(t).triggerHandler(A)})):e(o[0].contentWindow).focus(function(){e(t).triggerHandler(j)}).blur(function(){e(t).triggerHandler(A)}),s.click(h).keydown(function(e){K&&"Control"==p(t).type&&8==e.keyCode&&(p(t).clear(),e.preventDefault())}).bind("keyup mouseup",function(){v(t),F(t,!0)}),ne?t.$area.show():o.show(),e(function(){var e=t.$toolbar,a=e.children("div:last"),i=n.width(),s=a.offset().top+a.outerHeight()-e.offset().top+1;e.height(s),s=(/%/.test(""+r.height)?n.height():parseInt(r.height,10))-s,o.width(i).height(s),t.$area.width(i).height(Z?s-2:s),l(t,t.disabled),v(t)})}function v(t){ne||!te||t.focused||(t.$frame[0].contentWindow.focus(),window.focus(),t.focused=!0);var n=t.doc;K&&(n=u(t));var r=S(t);e.each(t.$toolbar.find("."+O),function(o,a){var i=e(a),s=e.cleditor.buttons[e.data(a,L)],l=s.command,d=!0;if(t.disabled)d=!1;else if(s.getEnabled){var c={editor:t,button:a,buttonName:s.name,popup:re[s.popupName],popupName:s.popupName,command:s.command,useCSS:t.options.useCSS};d=s.getEnabled(c),void 0===d&&(d=!0)}else if((r||ne)&&"source"!==s.name||K&&("undo"===l||"redo"===l))d=!1;else if(l&&"print"!==l&&(K&&"hilitecolor"===l&&(l="backcolor"),!K&&!ee||"inserthtml"!==l))try{d=n.queryCommandEnabled(l)}catch(u){d=!1}d?(i.removeClass(q),i.removeAttr(I)):(i.addClass(q),i.attr(I,I))})}function y(e){e.range&&(K?e.range[0].select():ee&&p(e).addRange(e.range[0]))}function C(e){setTimeout(function(){S(e)?e.$area.select():d(e,"selectall")},0)}function w(t){y(t);var n=u(t);if(K)return n.htmlText;var r=e("<layer>")[0];r.appendChild(n.cloneContents());var o=r.innerHTML;return r=null,o}function k(e){return y(e),K?u(e).text:p(e).toString()}function x(e,t,n){var r=s("msg",e.options,Y);r.innerHTML=t,T(e,r,n)}function T(t,n,r){var a,i,s,l=e(n);if(r){var d=e(r);a=d.offset(),i=--a.left,s=a.top+d.height()}else{var c=t.$toolbar;a=c.offset(),i=Math.floor((c.width()-l.width())/2)+a.left,s=a.top+c.height()-2}h(),l.css({left:i,top:s}).show(),r&&(e.data(n,R,r),l.bind(z,{popup:n},e.proxy(o,t))),setTimeout(function(){l.find(":text,textarea").eq(0).focus().select()},100)}function S(e){return e.$area.is(":visible")}function $(t,n){var r=t.$area.val(),o=t.options,i=o.updateFrame,s=e(t.doc.body);if(i){var l=a(r);if(n&&t.areaChecksum===l)return;t.areaChecksum=l}var d=i?i(r):r;d=d.replace(/<(?=\/?script)/gi,"&lt;"),o.updateTextArea&&(t.frameChecksum=a(d)),d!==s.html()&&(s.html(d),e(t).triggerHandler(M))}function F(t,n){var r=e(t.doc.body).html(),o=t.options,i=o.updateTextArea,s=t.$area;if(i){var l=a(r);if(n&&t.frameChecksum===l)return;t.frameChecksum=l}var d=i?i(r):r;document.getElementById("text_hide").value=d.replace("<br>",""),o.updateFrame&&(t.areaChecksum=a(d)),d!==s.val()&&(s.val(d),e(t).triggerHandler(M))}e.cleditor={defaultOptions:{width:"auto",height:175,controls:"bold italic underline strikethrough subscript superscript | font size style | color highlight removeformat | bullets numbering | outdent indent | alignleft center alignright justify | undo redo | rule image link unlink | cut copy paste pastetext | print source",colors:"FF0 3C0 0CC 000",fonts:"Arial,Verdana",sizes:"1,2,3",styles:[["Paragraph","<p>"],["Header 1","<h1>"]],useCSS:!0,docType:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',docCSSFile:"",bodyStyle:"margin:4px; font:10pt Arial,Verdana; cursor:text"},buttons:{init:"bold,,|italic,,|underline,,|strikethrough,,|subscript,,|superscript,,|font,,fontname,|size,Font Size,fontsize,|style,,formatblock,|color,Font Color,forecolor,|highlight,Text Highlight Color,hilitecolor,color|removeformat,Remove Formatting,|bullets,,insertunorderedlist|numbering,,insertorderedlist|outdent,,|indent,,|alignleft,Align Text Left,justifyleft|center,,justifycenter|alignright,Align Text Right,justifyright|justify,,justifyfull|undo,,|redo,,|rule,Insert Horizontal Rule,inserthorizontalrule|image,Insert Image,insertimage,url|link,Insert Hyperlink,createlink,url|unlink,Remove Hyperlink,|cut,,|copy,,|paste,,|pastetext,Paste as Text,inserthtml,|print,,|source,Show Source"},imagesPath:function(){return m()}},e.fn.cleditor=function(t){var n=e([]);return this.each(function(r,o){if("TEXTAREA"===o.tagName.toUpperCase()){var a=e.data(o,P);a||(a=new cleditor(o,t)),n=n.add(a)}}),n};var H,N="backgroundColor",A="blurred",R="button",L="buttonName",M="change",P="cleditor",z="click",I="disabled",E="<div>",j="focused",D="unselectable",W="cleditorMain",U="cleditorToolbar",B="cleditorGroup",O="cleditorButton",q="cleditorDisabled",V="cleditorDivider",_="cleditorPopup",G="cleditorList",Q="cleditorColor",X="cleditorPrompt",Y="cleditorMsg",J=navigator.userAgent.toLowerCase(),K=/msie/.test(J),Z=/msie\s6/.test(J),ee=/(trident)(?:.*rv:([\w.]+))?/.test(J),te=/webkit/.test(J),ne=/iPhone|iPad|iPod/i.test(J),re={},oe=e.cleditor.buttons;e.each(oe.init.split("|"),function(e,t){var n=t.split(","),r=n[0];oe[r]={stripIndex:e,name:r,title:""===n[1]?r.charAt(0).toUpperCase()+r.substr(1):n[1],command:""===n[2]?r:n[2],popupName:""===n[3]?r:n[3]}}),delete oe.init,cleditor=function(o,a){var i=this;i.options=a=e.extend({},e.cleditor.defaultOptions,a);var l=i.$area=e(o).css({border:"none",margin:0,padding:0}).hide().data(P,i).blur(function(){$(i,!0)}),d=i.$main=e(E).addClass(W).width(a.width).height(a.height),c=i.$toolbar=e(E).addClass(U).appendTo(d),u=e(E).addClass(B).appendTo(c),p=0;e.each(a.controls.split(" "),function(o,l){if(""===l)return!0;if("|"===l){e(E).addClass(V).appendTo(u);u.width(p+1),p=0,u=e(E).addClass(B).appendTo(c)}else{var d=oe[l],f=e(E).data(L,d.name).addClass(O).attr("title",d.title).bind(z,e.proxy(t,i)).appendTo(u).hover(n,r);p+=24,u.width(p+1);var h={};d.css?h=d.css:d.image&&(h.backgroundImage=g(d.image)),d.stripIndex&&(h.backgroundPosition=-24*d.stripIndex),f.css(h),K&&f.attr(D,"on"),d.popupName&&s(d.popupName,a,d.popupClass,d.popupContent,d.popupHover)}}),d.insertBefore(l).append(l),H||(e(document).click(function(t){var n=e(t.target);n.add(n.parents()).is("."+X)||h()}),H=!0),/auto|%/.test(""+a.width+a.height)&&e(window).bind("resize.cleditor",function(){b(i)}),b(i)};var ae=cleditor.prototype,ie=[["clear",i],["disable",l],["execCommand",d],["focus",c],["hidePopups",h],["sourceMode",S,!0],["refresh",b],["select",C],["selectedHTML",w,!0],["selectedText",k,!0],["showMessage",x],["updateFrame",$],["updateTextArea",F]];e.each(ie,function(e,t){ae[t[0]]=function(){for(var e=this,n=[e],r=0;r<arguments.length;r++)n.push(arguments[r]);var o=t[1].apply(e,n);return t[2]?o:e}}),ae.blurred=function(t){var n=e(this);return t?n.bind(A,t):n.trigger(A)},ae.change=function(t){var n=e(this);return t?n.bind(M,t):n.trigger(M)},ae.focused=function(t){var n=e(this);return t?n.bind(j,t):n.trigger(j)}}(jQuery);